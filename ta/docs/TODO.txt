2012-02-07

CTD - Complex Trend Detection

Предлагается комплексный подход к определению тренда.

Результатом определения значения CDT в моменте будет вещественное значение в
пределах от 1 до -1. Значения выше нуля свидетельствуют о восходящем тренде,
вероятность которого тем выше, чем ближе значение индикатора к единице. Значение
ниже нуля указывают на нисходящий тренд, вероятность которого тем выше, чем
ближе значение к -1. Значения близкие к нулю свидетельствуют о преобладании
бокового движения.

Среди существующих индикаторов достаточно много определяющих динамику тренда,
но неспособных определить его направление. Например, рост объема продаж может
рассматриваться как поддержка текущей тенденции, но по анализу динамики объема
невозможно определить куда направлена эта тенденция. В связи с этим, CTD
разделен на детекторы двух видов: направления и силы. Детектор направления
определяет направление тренда - uptrend или downtrend. Детектор силы определяет
силу тенденции от 0 до 1.  

Так как каждый их детекторов использует различные алгоритмы расчета, точность
результатов разных детекторов так же различна. Точность можно охарактеризовать
как отношение исторического результата к расчетному. Например, точность
детектора равная 0.5 свидетельствует о том, что исторически тенденция
совпадает с расчетной в 50% случаев. Естественно, что детектор с меньшей
точностью должен оказывать меньшее влияние на результат расчета CTD. 

================================================================================
Модификация стратегии Rupture. Вариант оптимизации защитного стопа.

Использовать ATR определения защитного стоп-лосса. ATR расчитывается на каждом
баре. Стоп лосс-выставляем со смещением X*N от цены открытия позиции,
где X - коэффициэнт (например 1.2 = 120% от текущего ATR). При движении цены в
"нашем" направлении двигаем стоп-лосс в нашем направлении с расчетом цены по
вышеописанной методике. При движении цены "против" нашего направления стоп-лосс
остается на месте.

В дальнейшем можно потестить фильтр по ATR. Если ATR выше средней прибыли по
сделке (в пунктах естессно), то возможно имеет смысл переждать волнение.  

2012-02-06

идея стратегии: смотреть по последним сделкам - прогнать тест от обратного
условия: что будет, если открывать в противоположную сторону. Если все последние
убыточные станут прибыльными, возможно имеет смысл использовать эту стратегию.

2012-02-02

идея: обкатать вариант с утренними гэпами

2012-02-01

Сбор статистики. Счетчики.

Сбор статистики основан на счетчиках, которые выполняют наблюдение за
соответствующими службами и расчитывают собственное состояние каждый раз при
получении соответствующего уведомления. Пользователь счетчика ничего не знает
о том, за какими службами ведется наблюдение и каков алгоритм расчета значения
счетчика. Пользователю гарантируется только одно - в любое время он может
запросить значение счетчика. Таким образом, механизм сбора статистики является
полностью независимым от способа использования статистической информации.
Совокупность счетчиков представляет собой набор статистических данных, доступных
в текущий момент времени и легко может быть организован в пул с помощью списка.  


2012-01-18

Были проведены некоторый анализ недостатков и доработки стратегии Теории Хаоса,
но все равно добиться устойчивых позитивных результатов не удается. В среднем
выходим в ноль. Так как на данную стратегию было потрачено довольно много
времени, принято решение переключиться на другой подход - торговля по шаблонам.

Вырисовывается следующий подход. Шаблон - это определенная последовательность
определенных баров. Так как бары все разные, требуется формализация шаблонного
представления бара. Предлагается следующая концепция: средняя высота бара
используется для определения размера эталонного сегмента - единицы или иначе -
точки в шаблонном представлении бара. Таким образом, любой бар средней высоты
может быть представлен в виде набора 5 точек (сегментов). Например:

XX   XXX  X  XX   X
 X    X  XXX  XX XXX 
 XX   X   X   X   X
 
и т.п. То есть средняя высота бара поделенная на 3 дает текущую высоту сегмента.
В зависимости от высоты, можно определить в каком сегменте находится хвосты
открытия и закрытия баров. Каждый бар раскладывается на определенное количество
сегментов, в зависимости от его высоты и соотвественно пропорций по отношению
к эталонному сегменту. Таким образом, любой бар можно охарактеризовать
следующими числами:
1. bottom сегмент лоу-бара (для опорного бара всегда будет равен нулю, но для
   баров в составе паттерна скорее всего будет отличаться)
2. top сегмент хая бара
3. open номер сегмента, в котором находится цена открытия
4. close номер сегмента в котором находится цена закрытия

Лоу опорного бара определяет точку отсчета для соседних (справа) баров. Именно
это значение цены является границей выравнивания сегментов, на которые будут
разбиваться последующие бары. В итоге получим наборы вида

         XX		3
XX   X   X		2
 X  XXX XX      1
 XX  X          0 нулевой сегмент
     X		   -1

и т.п. Далее следует выполнить сканирование исторических данных. При просмотре
с начала будут образовываться шаблоны, количество вхождений которых необходимо
определить для последующей сортировки. Отсортировав полученный результаты по
количеству вхождений получим наиболее эффективные паттерны, которые можно
брать за сигналы на открытие и закрытие позиций.  

2012-01-11

Поверхностное тестирование выявило крайне низкую эффективность базовой
стратегии. Постоянство результата (доходность) не обеспечивается в самых
разных комбинациях стоп-линии, таймфрейма (3-25 мин.) и способа закрытия
позиции. Для того, что бы выяснить причину, необходимо проанализировать сделки и
выявить слабое место стратегии. Общая статистика в данном случае не подходит,
так как она дает всего лишь внешние характеристики стратегии.

Так как стратегия подразумевает добор позиции, под сделками будем понимать
последовательность сделок начиная с момента открытия и до обнуления позиции.
Информацию о сделках необходимо представить в табличном виде, что бы можно
было сортировать по различным показателям. 

Какие показатели потребуются:

0. Конечно это прежде всего время открытия и закрытия позиции для того, чтобы
можно было посмотреть ситуацию на графике.
1. Далее, следует оценить потенциальную и реальную доходность сделки.
Потенциальная доходность - это доходность, которую мы получили бы, если продали
на соответствующем пике цены (для шорта - лоу, для лонга - хай). Цены
рассматриваются внутри периода, когда позиция открыта. Реальная доходность,
определяется как отношение суммы потреченной в процессе набора позиции к сумме
от закрытия позиции. 
2. Продолжительность удержания позиции в барах. 
3. Пиковая величина позиции (максимальный размер).


  

2012-01-05

Проблема с исполнением заявок. Заключается в том, что в подавляющем
большинстве случаев, проверка только что выставленной заявки приводит к ее
исполнению. Получается, что вся работа выполняется в холостую: выставили заявку
по сигналу, она тут же исполнилась. Сразу же за этим расчитывается защитная
заявка, которая часто попадает между lo/hi и так же исполняется.

Для заявок, стоявших на протяжении бара и для заявок выставляемых в конце
текущего бара нельзя использовать один и тот же алгоритм проверки исполнения.
Выставляемая прямо сейчас заявка не может быть исполнена по проверке lo/hi,
так как эти значения на момент выставления заявки представляют собой
исторические данные, а не текущую ситуацию. 

В каких случаях может быть исполнена заявка, выставленная прямо сейчас?
В случае, когда цена заявки удовлетворяет соответствующему условию относительно
цены закрытия бара. Например, при выставлении лимитной заявки на покупку, такая
заявка исполняется немедленно, если цена заявки выше цены закрытия бара.
Стоп-заявка на продажу исполняется немедленно (выставляется связанная заявка),
в случае если стоп-цена больше цены закрытия бара. И т.п.


2012-01-03

Расчет финансового результата в тестовом портфеле по расчетному фьючерсу.

Судя по всему, маржа перечисляется в "План. чист. поз." после клиринга. А вот
операционные расходы сразу вычитаются из "План. чист. поз.". Перечисление маржи
в чистую позицию можно делать раз в сутки вместе с пересчетом ГО. А операционные
расходы вычитать сразу.

Алгоритм

Целью тестового прогона является определение финансового результата
стратегии, а конечной целью тестирования - выявление оптимальной стратегии
путем сравнительного анализа финансовых показателей. В связи с этим, точное
следование алгоритмам расчета, применяемым на реальной бирже, не требуется.
Вместо этого будут использоваться приблизительные алгоритмы. 

Исходя из того, что робот ориентирован на торговлю расчетным фьючерсом,
первостепенной задачей является реализация алгоритма расчета вариационной маржи.
Так же необходимо обеспечить возможность трекинга маржин-колов.

Расчеты выполняются в рамках виртуального клирингового периода. Работа с таким
периодом подразумевает три этапа:

При открытии периода определяется расчетная цена. В качестве расчетной цены
берется цена закрытия предыдущего периода. Если цена предыдущего периода не
доступна, то используется цена закрытия текущего периода. Стоимость ГО
расчитывается упрощенно как определенная доля от расчетной цены. При открытии
периода, ГО и стоимость шага цены сохраняется до закрытия периода. Текущее
значение набранных пунктов вариационной маржи устанавливается по формуле:
	
	pos * estimated price,
	
где:
pos - текущая позция
estimated price - расчетная цена

В течение клирингового периода выполняется учет набранных или потерянных в
результате торговли пунктов. Это - вариационная маржа выраженная в пунктах.
При покупке эта величина будет увеличиваться, а при продаже - уменьшаться на
qty * price. При увеличении позиции с баланса списывается ГО, пропорционально
количеству. При уменьшении позиции - ГО возвращается на баланс. В моменте
можно расчитать вариационную маржу в деньгах по формуле:

 	(margin - (pos * close)) * price step money / price step
 	
где:
margin - маржа в пунктах
pos - текущая позиция
close - текущая цена актива в пунктах
price step money - стоимость шага цены
price step - шаг цены

И совокупное ГО по формуле:

	abs(pos) * initial margin
	
где:
abs(pos) - текущая позиция
initial margin - ГО текущего периода

При закрытии периода выполняются следующие действия. ГО по открытым позициям
возвращается на баланс портфеля. Накопленные пункты (см. расчет вариационной
маржи в моменте) вариационной маржи переводятся в деньги и в зависимости от
результата зачисляются на баланс или списываются с баланса портфеля.    

2011-12-28

I. Необходимо подобрать оптимальную стратегию на основе стратегии Теории хаоса.
Цели оптимизации: подобрать такую систему, которая даст максимальную прибыль.
Нефункциональные требования: объем начальных инвестиций определяется вручную.

Для этого понадобятся две подсистемы:
1. Тест-портфель, эмулирующий работу реального портфеля.
2. Система съема финансовых показателей.

Какие показатели требуются в первую очередь:
1. Drawdown протфеля в абсолютном и процентном выражении
2. Rate of return в процентном отношении
3. Profit в абсолютном выражении

Так как тут сразу возникает соблазн рассматривать показатели в разрезе
различных временных периодов, что на данный момент выглядит довольно абстрактно,
пока мы этот соблазн отбросим и будем рассматривать простейший вариант сбора
информации для полного рабочего периода. 

Пересчет показателей будет выполняться в момент изменения состояния
соответсвующей подсистемы: изменения баланса и позиции, исполнение заявки и т.п.
Объекты-счетчики будут инкапсулированы в списке, который будет служить фасадом
к подсистеме сбора статистики. Через фасад можно будет одним вызовом начинать
и прекращать мониторинг.


2011-12-20

Обнаружилась проблема в связке rxltdde трансмиттера и робота. Проблема
в том, что в случае перезапуска робота и последовательного переподключения
rxltdde необходимые данные, типа состояния портфеля, повторно не отправляются.
Квик то не знает что эти данные требуются снова, а трансмиттер ничего не знает
о структуре данных, которые он получает и передает. Велика вероятность забыть
об этом при перезапуске робота и получить холостой запуск.

2011-11-30
Недостающие компоненты для полноценной работы робота:
* Информация о портфеле (свободные средства, открытая позиция)
* Драйвер выставления/снятия заявок

2011-11-13

* Есть идея, что сильные тормоза, возникающие на более поздних этапах, когда
  накапливается много данных, связаны не с большим количеством значений в
  истории Value, а с большим объемом работы в цикле в Portfolio#updateOrders.

* Из-за сложности формализации не реализованы сигналы "Два пика"
  для Awesome Oscillator. 
  
* Для всех ордеров, выставленных по сигналам на основе AO, необходимо снимать
  ордер, если появился "недружественный" столбец.
  
* Для всех ордеров, выставленных по сигналам на основе AC, необходимо снимать
  ордер, если появился "недружественный" столбец.
  
