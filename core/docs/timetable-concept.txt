Концепция расписания

Существует ряд задач, выполнение которых имеет смысл только в определенные
промежутки времени - по расписанию. Например, для планирования работы торгового
робота, который должен торговать в определенные часы дня с учетом периодов
клиринга, в определенные дни недели, исключая праздничные дни. Из подобных задач
вытекает частная подзадача определения ближайшего времени начала или завершения
работы.

Формально, расписание можно выразить через состояние сигнала булева типа
(включено/выключено) с привязкой к временной шкале. Субъектом проверки всегда
является временная метка (абсолютное положение на временной шкале), а
результатом проверки булево значение, определяющее состояние сигнала на
указанный момент времени. Таким образом, любое расписание может быть
представлено как совокупность временных отрезков. Если временная метка
принадлежит одному из отрезков расписания, значит это время внутри расписания.

Гораздо более сложная задача, предоставить удобный интерфейс для составления
расписания человеком. Простое представление временного отрезка в виде двух
временных меток, определяющих его начало и конец, делает расписание недостаточно
практичным для человека. Например, при составлении расписания для торгового
робота с учетом всех клирингов только на ближайшую неделю, придется определить
несколько десятков отрезков, каждый из которых характеризуется парой временных
меток (то есть, двух значений абсолютного времени). Таким образом, явно
прослеживается большой объем работ, связанных с администрированием расписания.

В виду этого, основную задачу пакета можно сформулировать как предоставление
такого способа формирования расписания, которое позволяет определять как общие
промежутки (например, внутри рабочего дня), так и частные (например, исключать
праздники).      

Часто процесс составления раписания можно разбить на два этапа - это расписание
по дням и часам. Расписание по дням определяет в какие дни нужно работать.
Расписание по часам определяет время работы внутри дня.

Предположим, есть два периода: дневной, определяющий рабочие дни, и
внутридневной, определяющий время работы внутри этих дней. Задача: определить
для произвольной временной метки точное время начала следующего рабочего периода
и время его окончания.


<timetable-example>
  <days>
    <period type="DaysOfWeek" from="MONDAY" to="FRIDAY" />
  </days>
  <sessionTime>
    <period type="HourMinute" from="09:30" to="16:00" />
  </sessionTime>
  <allowOpenPosition>
    <period type="HourMinute" from="09:33" to="13:00" />
  </allowOpenPosition>
  <forceClosePosition>
    <period type="HourMinute" from="15:55" to="16:00" />
  </forceClosePosition>
</timetable-example>

