Директива 20170924
[[[[ Об изменении требований к реализациям очередей событий ]]]]


Идея, что бы обдумать:
когда некий поток делает enqueue, никто ему не гарантирует, что конкурирующие
потоки не смогут посылать событие перед ним. Но это не верно для тех потоков,
которые как то синхронизируют свою работу между собой. Но насчет одного потока
мы можем быть точно уверены, что он не зависит от других. По крайней мере - не
должен и это серьезное требование к обработчикам событий. Так вот это тред
очереди. Мы можем оставить тормозяку для других потоков, но события, которые
пуляются в очередь из потока очереди можно ложить в конец очереди... (Хотя они
и так в конце). В общем есть ощущение, что здесь может быть решение.

Основание

--------------------------------------------------------------------------------

Подход

Запрос на диспетчеризацию - это обращение пользователя к очереди с целью
генерации и диспетчеризации события на базе некоторого исходного типа события и
фабрики событий. Запрос на диспетчерезацию должен быть неблокирующим и
выполняться максимально быстро. Для этого используется очередь объектов
нелимитированного размера. Очередь блокирующая, что бы обеспечить возможность
блокирования потока диспетчеризации при ожидании поступления новых запросов.

Диспетчер очереди - это отдельный поток, который обрабатывает запросы на
диспетчеризацию событий. Диспетчер извлекает запрос из очереди и формирует
список всех типов событий, которые задействованы в диспетчеризации данного
события (alternate types). Далее, для каждого задействованного типа посредством
фабрики событий генерируется экземпляр события. Для каждого получателя
очередного типа формируется индивидуальный запрос на доставку события
получателю. Список всех запросов передается пулу потоков для доставки. Диспетчер
событий ожидает когда все воркеры завершат доставку, после чего переходит к
обработке следующего запроса на диспетчеризацию. 

Воркер - это отдельный поток из пула потоков, который обрабатывает запросы на
доставку события отдельному получателю. Воркер создается посредством фабрики
потоков.

Фабрика потоков используется для создания потоков пула. Фабрика сохраняет
информацию о всех созданных потоках и позволяет проверить, был ли указанный
поток создан фабрикой или этот поток создан в другом месте. Так же фабрика
задает создаваемым потокам имена, которые являются производными от имени
очереди и позволяют различать воркеры, относящиеся к разным очередям событий.

--------------------------------------------------------------------------------

Порядок редизайна

